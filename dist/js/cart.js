"use strict";$(function(){var t=Cookie.get("username");$(".cartName").html(t),$(".cartBack").click(function(){location.href="reglog.html"});var c=document.querySelector(".cart_list");t=Cookie.get("username");function a(){var t=0,a=$(".cart_list").find(".sCheck");a.each(function(){$(this).prop("checked")&&++t}),t==a.size()?$(".all_check").prop("checked",!0):$(".all_check").prop("checked",!1)}function i(){var t=$(".cart_list .good_check").find("input"),a=0,n=0;t.each(function(){if($(this).parent().parent().removeClass("list_active"),$(this).prop("checked")){n++;var t=$(this).parent().nextAll(".good_total").text();t=t.slice(1),a+=1*t,$(this).parent().parent().addClass("list_active")}}),$(".account .good_num").find("span").html(n),$(".account .good_sum").find("span").html("￥"+a.toFixed(2)),0==a?$(".buy_btn a").css("background","#ccc"):$(".buy_btn a").css("background","#C41F3A")}function e(t){var a=1*t.parent().parent().find(".good_price span").html(),n=(a*(1*t.parent().find(".put").val())).toFixed(2);t.parent().parent().find(".good_total span").html(n),console.log(a)}url="../api/cart.php",data4="uid="+t+"&time=new Date()",ajax("GET",url,data4,function(t){var a=JSON.parse(t);console.log(a);var n=a.datalist.map(function(t){var a=t.bigimg.split("-")[0];return'<dl class="list_part">\n\t               <dt class="clearfix list_title">\n\t                   <div class="tit_l fl">\n\t                       <input type="checkbox" class="sCheck"><span>自营</span>速普商城\n\t                   </div>\n\t                   <div class="tit_r fr">\n\t                       <span>在线支付满129.00包邮</span>\n\t                   </div>\n\t               </dt>\n\t               <dd class="list_con clearfix" data-id="'+t.cid+'">\n\t                   <div class="good_check fl">\n\t                       <input type="checkbox">\n\t                   </div>\n\t                   <div class="good_img">\n\t                       <img src="'+a+'" alt="">\n\t                   </div>\n\t                   <div class="good_name"><a href="javascript:;">'+t.goodname+'</a></div>\n\t                   <div class="good_price">￥<span>'+t.price+'</span></div>\n\t                   <div class="good_num">\n\t                       <input type="button" class="sub" value="-">\n\t                       <input type="text" class="put" value="'+t.nums+'">\n\t                       <input type="button" class="add" value="+">\n\t                   </div>\n\t                   <div class="good_total">￥<span>'+(t.price*t.nums).toFixed(2)+'</span></div>\n\t                   <div class="remove">\n\t                       <input type="button" class="del" value="删除">\n\t                   </div>\n\t               </dd>\n\t           </dl>'}).join("");c.innerHTML=n}),$(".all_check").click(function(){var t=$(this).prop("checked");$(".all_check").prop("checked",t),$(".list_part .tit_l").find("input").prop("checked",t),$(".list_con .good_check").find("input").prop("checked",t),i()}),$(".cart_list").on("click",".sCheck",function(){var t=$(this).prop("checked");$(this).parent().parent().parent().find(".good_check input").prop("checked",t);a(),i()}),$(".cart_list").on("click",".good_check input",function(){0==$(this).prop("checked")&&($(".all_check").prop("checked",!1),$(this).parent().parent().parent().find(".tit_l input").prop("checked",!1)),function(t){var a=0,n=t.parent().parent().parent().find("dd .good_check input");n.each(function(){$(this).prop("checked")&&++a}),a==n.size()&&t.parent().parent().prevAll("dt").find(".sCheck").prop("checked",!0);i()}($(this)),a()}),$(".cart_list").on("click",".sub",function(){var t=$(this).parent().parent().attr("data-id");$.ajax({type:"GET",url:"../api/addSub.php",cache:!1,data:{cid:t,type:"sub"},success:function(t){var a=JSON.parse(t);"0"==a.code&&($(this).parent().find(".put").val(a.nums),$(this).parent().find(".put").attr("data-num",a.nums),e($(this)),i())}.bind($(this))})}),$(".cart_list").on("click",".add",function(){var t=$(this).parent().parent().attr("data-id");$.ajax({type:"GET",url:"../api/addSub.php",cache:!1,data:{cid:t,type:"add"},success:function(t){var a=JSON.parse(t);"0"==a.code&&($(this).parent().find(".put").val(a.nums),$(this).parent().find(".put").attr("data-num",a.nums),e($(this)),i())}.bind($(this))})}),$(".cart_list").on("change",".put",function(){var t=$(this).parent().parent().attr("data-id"),a=1*$(this).val(),n=$(this).attr("data-num");isNaN(a)?(alert("只能输入数字"),$(this).val(n)):$.ajax({type:"GET",url:"../api/addSub.php",cache:!1,data:{cid:t,type:a},success:function(t){var a=JSON.parse(t);"0"==a.code&&($(this).val(a.nums),$(this).attr("data-num",a.nums),e($(this)),i())}.bind($(this))})}),$(".cart_list").on("click",".del",function(){var t=$(this).parent().parent().attr("data-id");console.log(t);var n=$(this).parent().parent().index();confirm("您确定要移除这个商品吗？")&&$.ajax({type:"GET",url:"../api/newDel.php",data:{cid:t},success:function(t){if("0"==JSON.parse(t).code){var a=$(this).parent().parent().parent();a.children().eq(n).remove(),1==a.children().size()&&a.remove()}0==$(".cart_list").children().length&&updatacart()}.bind($(this))})})});